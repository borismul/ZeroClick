---
phase: 07-compliance-foundation
plan: 02
type: execute
depends_on: []
files_modified:
  - mobile/ios/Runner/PrivacyInfo.xcprivacy
  - watch/MileageWatch/MileageWatch/PrivacyInfo.xcprivacy
---

<objective>
Verify and complete PrivacyInfo.xcprivacy manifests for App Store compliance.

Purpose: Apple requires privacy nutrition labels that accurately reflect app data practices.
Output: Updated PrivacyInfo.xcprivacy files covering all API usage and data collection.
</objective>

<execution_context>
./.claude/get-shit-done/workflows/execute-plan.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@mobile/ios/Runner/PrivacyInfo.xcprivacy
@watch/MileageWatch/MileageWatch/PrivacyInfo.xcprivacy

**Current PrivacyInfo.xcprivacy coverage:**
- Precise location (linked, app functionality)
- User ID via Google Sign-In (linked, app functionality)
- Email address (linked, app functionality)
- UserDefaults API (CA92.1 - app-specific data)
- File timestamp API (C617.1)

**Missing coverage to verify:**
- Analytics data (Firebase Analytics added in Phase 6.2)
- Crash logs (Crashlytics added in Phase 6)
- Device identifiers if any
- Disk space API usage if any
</context>

<tasks>

<task type="auto">
  <name>Task 1: Audit and update mobile app PrivacyInfo.xcprivacy</name>
  <files>mobile/ios/Runner/PrivacyInfo.xcprivacy</files>
  <action>
Review the current PrivacyInfo.xcprivacy and add missing declarations:

1. **Analytics data** (added in Phase 6.2):
   - NSPrivacyCollectedDataTypeDeviceID (if Firebase uses IDFA)
   - Add purpose: NSPrivacyCollectedDataTypePurposeAnalytics

2. **Crash data** (added in Phase 6):
   - NSPrivacyCollectedDataTypeCrashData
   - Linked: true (associated with user for debugging)
   - Purpose: NSPrivacyCollectedDataTypePurposeAppFunctionality

3. **Performance data** (if used):
   - NSPrivacyCollectedDataTypePerformanceData

4. **Verify NSPrivacyAccessedAPITypes includes:**
   - UserDefaults (CA92.1) - already present
   - File timestamp (C617.1) - already present
   - System boot time (if used) - 35F9.1
   - Disk space (if used) - E174.1

5. **Update NSPrivacyTracking:**
   - Keep as false (we don't track for advertising)
   - But add comment that we use analytics for app improvement

Check AppDelegate.swift and Flutter plugins for any additional API usage that needs declaration.
  </action>
  <verify>
xcodebuild -project mobile/ios/Runner.xcodeproj -scheme Runner -destination 'platform=iOS Simulator,name=iPhone 16' -configuration Debug CODE_SIGNING_ALLOWED=NO build 2>&1 | grep -E "(error|warning.*Privacy)" || echo "No privacy warnings"
  </verify>
  <done>
PrivacyInfo.xcprivacy covers all data collection and API usage.
Build completes without privacy manifest warnings.
  </done>
</task>

<task type="auto">
  <name>Task 2: Verify and update watch app PrivacyInfo.xcprivacy</name>
  <files>watch/MileageWatch/MileageWatch/PrivacyInfo.xcprivacy</files>
  <action>
Review the watch app's PrivacyInfo.xcprivacy:

1. **Check current coverage** by reading the file.

2. **Required declarations for watch app:**
   - User ID (synced from iPhone via Keychain)
   - Network activity (API calls to backend)
   - Keychain access for auth token

3. **Verify NSPrivacyAccessedAPITypes:**
   - UserDefaults (if used)
   - Any other privacy-sensitive APIs

4. **Keep consistent with mobile app** where data overlaps (same user ID, same backend).

The watch app is simpler - it mainly reads trip data and doesn't collect additional data beyond what iPhone collects.
  </action>
  <verify>
xcodebuild -project watch/MileageWatch/MileageWatch.xcodeproj -scheme MileageWatch -destination 'generic/platform=watchOS' -configuration Debug CODE_SIGNING_ALLOWED=NO build 2>&1 | grep -E "(error|warning.*Privacy)" || echo "No privacy warnings"
  </verify>
  <done>
Watch app PrivacyInfo.xcprivacy accurately reflects its minimal data usage.
Build completes without privacy manifest warnings.
  </done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] Mobile app PrivacyInfo.xcprivacy covers analytics, crash data
- [ ] Watch app PrivacyInfo.xcprivacy is accurate
- [ ] Both Xcode projects build without privacy warnings
- [ ] No new data collection goes undeclared
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- Privacy manifests accurately reflect app behavior
- Ready for App Store privacy questionnaire
</success_criteria>

<output>
After completion, create `.planning/phases/07-compliance-foundation/07-02-SUMMARY.md`
</output>
