---
phase: 05-flutter-ui-refactoring
plan: 03
type: execute
depends_on: []
files_modified:
  - mobile/lib/widgets/onboarding_widgets.dart
  - mobile/lib/screens/permission_onboarding_screen.dart
---

<objective>
Refactor permission_onboarding_screen.dart by extracting reusable widgets.

Purpose: Reduce permission_onboarding_screen.dart from 969 lines by extracting SetupStepCard and FeatureItem widgets, improving maintainability.
Output: New onboarding_widgets.dart with extracted widgets, permission_onboarding_screen.dart reduced to ~750 lines.
</objective>

<execution_context>
./.claude/get-shit-done/workflows/execute-plan.md
./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/codebase/CONVENTIONS.md

**Note:** This plan is independent of 05-01/05-02 and can run in parallel.

**Key files:**
@mobile/lib/screens/permission_onboarding_screen.dart
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create onboarding_widgets.dart with SetupStepCard</name>
  <files>mobile/lib/widgets/onboarding_widgets.dart</files>
  <action>
1. Create mobile/lib/widgets/onboarding_widgets.dart
2. Add required imports:
   - flutter/material.dart
3. Move and rename _SetupStepCard to SetupStepCard (make public):
   - Copy class from permission_onboarding_screen.dart (lines 831-969)
   - Remove underscore prefix
   - This is a self-contained widget with no external dependencies
4. Move and rename _FeatureItem to FeatureItem (make public):
   - Copy class from permission_onboarding_screen.dart (lines 817-829)
   - Remove underscore prefix
   - This is a simple data class
  </action>
  <verify>File compiles: `cd mobile && flutter analyze lib/widgets/onboarding_widgets.dart`</verify>
  <done>onboarding_widgets.dart exists with SetupStepCard and FeatureItem, compiles</done>
</task>

<task type="auto">
  <name>Task 2: Update permission_onboarding_screen.dart to use extracted widgets</name>
  <files>mobile/lib/screens/permission_onboarding_screen.dart</files>
  <action>
1. Add import at top: import '../widgets/onboarding_widgets.dart';
2. Remove extracted classes:
   - Delete _SetupStepCard class (lines 831-969)
   - Delete _FeatureItem class (lines 817-829)
3. Update usages (class names now without underscore):
   - _SetupStepCard -> SetupStepCard
   - _FeatureItem -> FeatureItem
4. Verify all usages in _buildFeaturePage and _buildCarSetupPage work correctly
  </action>
  <verify>`cd mobile && flutter analyze` passes, `flutter build ios --no-codesign` succeeds</verify>
  <done>permission_onboarding_screen.dart reduced to ~750 lines, uses imported widgets, app builds</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `flutter analyze` passes with no errors
- [ ] `flutter build ios --no-codesign` succeeds
- [ ] permission_onboarding_screen.dart line count ~750 (down from 969)
- [ ] onboarding_widgets.dart contains SetupStepCard and FeatureItem
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- Widgets extracted and reusable
- Phase 5 complete
</success_criteria>

<output>
After completion, create `.planning/phases/05-flutter-ui-refactoring/05-03-SUMMARY.md`

Include in summary:
- Final line counts for all refactored files
- Phase 5 complete status
</output>
