---
phase: 06-error-handling-logging
plan: 02
type: execute
depends_on: []
files_modified: [mobile/ios/Runner/Services/LoggingService.swift, mobile/ios/Runner/Services/LocationTrackingService.swift, mobile/ios/Runner/Services/MotionActivityHandler.swift, mobile/ios/Runner/Services/LiveActivityManager.swift, mobile/ios/Runner/Services/WatchConnectivityService.swift, mobile/ios/Runner/AppDelegate.swift, watch/MileageWatch/MileageWatch/APIClient.swift, watch/MileageWatch/MileageWatch/MileageViewModel.swift, watch/MileageWatch/MileageWatch/WatchConnectivityManager.swift]
---

<objective>
Replace print() statements in iOS and Watch apps with Apple's unified logging system (os.Logger).

Purpose: Use proper logging framework that integrates with Console.app, persists logs, and supports log levels and categorization.
Output: All iOS and Watch native code uses os.Logger instead of print().
</objective>

<execution_context>
./.claude/get-shit-done/workflows/execute-plan.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md

**Current state:**
- iOS services use `print("[Tag] message")` pattern extensively
- Watch app uses similar print-based logging
- No os.Logger integration
- ~30+ print statements in iOS services, ~30+ in Watch app

**Key files:**
@mobile/ios/Runner/Services/LocationTrackingService.swift
@mobile/ios/Runner/Services/MotionActivityHandler.swift
@mobile/ios/Runner/AppDelegate.swift
@watch/MileageWatch/MileageWatch/APIClient.swift
@watch/MileageWatch/MileageWatch/MileageViewModel.swift
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create unified LoggingService for iOS</name>
  <files>mobile/ios/Runner/Services/LoggingService.swift</files>
  <action>
Create new file `mobile/ios/Runner/Services/LoggingService.swift`:

```swift
import Foundation
import os

/// Unified logging service using Apple's os.Logger
/// Categories: app, location, motion, api, watch, liveActivity
struct ZeroClickLogger {
    private static let subsystem = Bundle.main.bundleIdentifier ?? "com.zeroclick"

    static let app = Logger(subsystem: subsystem, category: "app")
    static let location = Logger(subsystem: subsystem, category: "location")
    static let motion = Logger(subsystem: subsystem, category: "motion")
    static let api = Logger(subsystem: subsystem, category: "api")
    static let watch = Logger(subsystem: subsystem, category: "watch")
    static let liveActivity = Logger(subsystem: subsystem, category: "liveActivity")
}

// Convenience extension for common logging patterns
extension Logger {
    /// Log debug info (only visible in Console.app debug mode)
    func debugLog(_ message: String) {
        self.debug("\(message, privacy: .public)")
    }

    /// Log info (default level)
    func infoLog(_ message: String) {
        self.info("\(message, privacy: .public)")
    }

    /// Log notice (important but not an error)
    func noticeLog(_ message: String) {
        self.notice("\(message, privacy: .public)")
    }

    /// Log error
    func errorLog(_ message: String) {
        self.error("\(message, privacy: .public)")
    }
}
```

Using `.public` privacy for messages since trip data isn't sensitive (coordinates are already in Firestore).
  </action>
  <verify>cd mobile/ios && xcodebuild -scheme Runner -sdk iphonesimulator -configuration Debug build CODE_SIGN_IDENTITY="" CODE_SIGNING_REQUIRED=NO 2>&1 | grep -E "(error:|BUILD)" | head -5</verify>
  <done>LoggingService.swift created with ZeroClickLogger struct providing categorized loggers</done>
</task>

<task type="auto">
  <name>Task 2: Replace print() in iOS services with ZeroClickLogger</name>
  <files>mobile/ios/Runner/Services/LocationTrackingService.swift, mobile/ios/Runner/Services/MotionActivityHandler.swift, mobile/ios/Runner/Services/LiveActivityManager.swift, mobile/ios/Runner/Services/WatchConnectivityService.swift, mobile/ios/Runner/AppDelegate.swift</files>
  <action>
Replace all print() calls with appropriate ZeroClickLogger calls:

**LocationTrackingService.swift:**
- Replace `print("[Location] ...")` with `ZeroClickLogger.location.infoLog("...")`
- Replace error prints with `ZeroClickLogger.location.errorLog("...")`

**MotionActivityHandler.swift:**
- Replace `print("[Motion] ...")` with `ZeroClickLogger.motion.infoLog("...")`
- Replace `print("[Motion] Error: ...")` with `ZeroClickLogger.motion.errorLog("...")`

**LiveActivityManager.swift:**
- Replace `print("[LiveActivity] ...")` with `ZeroClickLogger.liveActivity.infoLog("...")`

**WatchConnectivityService.swift:**
- Replace `print("[WatchConn] ...")` with `ZeroClickLogger.watch.infoLog("...")`

**AppDelegate.swift:**
- Replace `print("[Config] ...")`, `print("[Auth] ...")`, `print("[API] ...")` with appropriate logger
- Use `ZeroClickLogger.app` for general app logs
- Use `ZeroClickLogger.api` for API call logs
- Use `ZeroClickLogger.location` for location-related logs

Pattern mapping:
- `print("[Tag] Some message")` → `ZeroClickLogger.tag.infoLog("Some message")`
- `print("[Tag] Error: ...")` → `ZeroClickLogger.tag.errorLog("...")`
- Startup/config logs → use `.noticeLog()` since they're important

Do NOT change any logic - only replace print() with logger calls.
  </action>
  <verify>cd mobile/ios && grep -r "print\(" Runner/Services/*.swift Runner/AppDelegate.swift 2>/dev/null | wc -l should be 0 or very low (only in debug-only paths)</verify>
  <done>All iOS services use ZeroClickLogger instead of print(), no print() statements remain in services</done>
</task>

<task type="auto">
  <name>Task 3: Replace print() in Watch app with os.Logger</name>
  <files>watch/MileageWatch/MileageWatch/APIClient.swift, watch/MileageWatch/MileageWatch/MileageViewModel.swift, watch/MileageWatch/MileageWatch/WatchConnectivityManager.swift, watch/MileageWatch/MileageWatch/KeychainHelper.swift</files>
  <action>
Add logging to Watch app. Create logger inline since Watch is separate target:

1. In each file that uses print(), add at top:
   ```swift
   import os
   private let logger = Logger(subsystem: "com.zeroclick.watch", category: "categoryName")
   ```

2. Replace print() calls:

**APIClient.swift** (category: "api"):
- Replace `print("[API] ...")` with `logger.info("...")`
- Replace error/401 logs with `logger.error("...")`

**MileageViewModel.swift** (category: "viewModel"):
- Replace `print("[VM] ...")` or similar with `logger.info("...")`
- Replace error logs with `logger.error("...")`

**WatchConnectivityManager.swift** (category: "connectivity"):
- Replace `print("[WC] ...")` with `logger.info("...")`

**KeychainHelper.swift** (category: "keychain"):
- Replace `print("[Keychain] ...")` with `logger.info("...")`
- Security-sensitive logs should use `.debug()` level (not shown by default)

Pattern mapping:
- `print("[Tag] message")` → `logger.info("message")`
- Error messages → `logger.error("message")`
- Token/credential logs → `logger.debug("message")` (hidden by default)

Do NOT change any logic - only replace print() with logger calls.
  </action>
  <verify>cd watch/MileageWatch && xcodebuild -scheme MileageWatch -sdk watchsimulator -configuration Debug build CODE_SIGN_IDENTITY="" CODE_SIGNING_REQUIRED=NO 2>&1 | grep -E "(error:|BUILD)" | head -5</verify>
  <done>All Watch app files use os.Logger instead of print(), logs are categorized and leveled</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `cd mobile/ios && xcodebuild -scheme Runner -sdk iphonesimulator build` succeeds
- [ ] `cd watch/MileageWatch && xcodebuild -scheme MileageWatch -sdk watchsimulator build` succeeds
- [ ] No print() calls remain in iOS services (grep returns 0)
- [ ] No print() calls remain in Watch app source files
- [ ] All logs use appropriate categories (location, motion, api, watch, etc.)
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- iOS services use ZeroClickLogger with proper categories
- Watch app uses os.Logger with proper categories
- Logs will appear in Console.app with proper filtering
- No print() statements remain (except potentially in debug-only code)
</success_criteria>

<output>
After completion, create `.planning/phases/06-error-handling-logging/06-02-SUMMARY.md`:

# Phase 6 Plan 02: iOS/Watch Logging Modernization Summary

**[One-liner summary of what was accomplished]**

## Accomplishments

- [Key outcome 1]
- [Key outcome 2]

## Files Created/Modified

- `path/to/file.swift` - Description

## Decisions Made

[Key decisions and rationale, or "None"]

## Issues Encountered

[Problems and resolutions, or "None"]

## Next Step

Ready for 06-03-PLAN.md (API structured logging)
</output>
